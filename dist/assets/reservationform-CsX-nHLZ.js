import{r as i,J as R,j as e}from"./index-ffYVKfzY.js";import{M as r,B as D}from"./Modal-DHu8A-az.js";const ee=({show:v,handleClose:_,addReservation:A,updateReservation:I,reservation:n,client:x})=>{const[T,E]=i.useState([]),[B,M]=i.useState([]),[X,F]=i.useState([]),[c,p]=i.useState({dateReserve:"",dateCheckin:"",dateCheckout:"",numberNights:""}),[l,d]=i.useState([{roomType:"",roomAssigned:""}]),[C,b]=i.useState([]),[O,m]=i.useState(!1),[H,g]=i.useState(""),[$,y]=i.useState(!1),[q,N]=i.useState(""),j=t=>new Date(t).toISOString().split("T")[0];i.useEffect(()=>{(async()=>{try{const o=await R.get("http://localhost:5000/api/rooms"),s=await R.get("http://localhost:5000/api/roomtypes"),a=await R.get("http://localhost:5000/api/reservations");E(o.data),M(s.data),F(a.data)}catch(o){console.error("Error fetching data:",o)}})()},[]),i.useEffect(()=>{v?n&&(p({dateReserve:j(n.date_reserve),dateCheckin:j(n.date_checkin),dateCheckout:j(n.date_checkout),numberNights:n.number_nights,guests_id_guest:n.guests_id_guest}),d(n.rooms.map(t=>({roomType:t.roomTypeId,roomAssigned:t.id}))||[{roomType:"",roomAssigned:""}]),b(n.rooms.map(t=>t.id))):(p({dateReserve:"",dateCheckin:"",dateCheckout:"",numberNights:"",guests_id_guest:""}),d([{roomType:"",roomAssigned:""}]),b([]))},[v,n]);const f=t=>{const{name:o,value:s}=t.target;p({...c,[o]:s}),(o==="dateCheckin"||o==="dateCheckout")&&G(s,o)},G=(t,o)=>{const s=o==="dateCheckin"?new Date(t):new Date(c.dateCheckin),a=o==="dateCheckout"?new Date(t):new Date(c.dateCheckout);if(s&&a&&a>s){const h=(a-s)/(1e3*3600*24);p(k=>({...k,numberNights:h}))}},J=(t,o)=>{const s=[...l];s[t].roomType=o,s[t].roomAssigned="",d(s)},U=async(t,o,s)=>{try{const a=parseInt(t,10);if(isNaN(a))return console.error("Invalid roomId provided:",t),g("Invalid room ID."),m(!0),!1;const u={roomId:a,checkin:new Date(o).toISOString(),checkout:new Date(s).toISOString(),_:new Date().getTime()};return console.log("Sending the following parameters to the backend:",u),(await R.get("http://localhost:5000/api/availability",{params:u})).data.isAvailable}catch(a){return console.error("Error checking room availability:",a),g("Error checking room availability."),m(!0),!1}},z=async(t,o)=>{const{dateCheckin:s,dateCheckout:a}=c;if(!await U(o,s,a)){g(`Room ID: ${o} is not available for the selected dates.`),m(!0);return}const h=[...l];if(C.includes(o)){g(`Room ID: ${o} has already been assigned.`),m(!0);return}h[t].roomAssigned=o,d(h);const k=h.map(W=>W.roomAssigned).filter(Boolean);b(k)},K=()=>{d([...l,{roomType:"",roomAssigned:""}])},L=t=>{const o=l.filter((a,u)=>u!==t);d(o);const s=o.map(a=>a.roomAssigned).filter(Boolean);b(s)},P=async t=>{t.preventDefault();const o=l.map(a=>parseInt(a.roomAssigned,10)).filter(a=>!isNaN(a)),s={...c,rooms:o,date_reserve:new Date(c.dateReserve).toISOString(),date_checkin:new Date(c.dateCheckin).toISOString(),date_checkout:new Date(c.dateCheckout).toISOString(),number_nights:c.numberNights,guests_id_guest:n?n.guests_id_guest:x.idGuest};console.log("Sending reservation data to backend:",s);try{n?(await I({...n,...s}),N(`Reservation updated successfully for Guest ID: ${n.guests_id_guest}!`)):(await A(s),N(`Reservation added successfully for Guest ID: ${x.id_guest}!`)),y(!0)}catch(a){console.error("Error handling reservation:",a),g("An error occurred while processing the reservation."),m(!0)}},Q=t=>t?T.filter(s=>s.room_type_id===parseInt(t)&&s.status==="1"&&!C.includes(s.id)):[],V=t=>t?`Room ID: ${t}`:"N/A",S=()=>m(!1),w=()=>y(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(r,{show:v,onHide:_,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:n?"Edit Reservation":"Add Reservation"})}),e.jsx(r.Body,{children:e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"dateReserve",className:"form-label",children:"Reservation Date"}),e.jsx("input",{type:"date",id:"dateReserve",name:"dateReserve",className:"form-control",value:c.dateReserve,onChange:f,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"dateCheckin",className:"form-label",children:"Check-in Date"}),e.jsx("input",{type:"date",id:"dateCheckin",name:"dateCheckin",className:"form-control",value:c.dateCheckin,onChange:f,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"dateCheckout",className:"form-label",children:"Check-out Date"}),e.jsx("input",{type:"date",id:"dateCheckout",name:"dateCheckout",className:"form-control",value:c.dateCheckout,onChange:f,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"numberNights",className:"form-label",children:"Number of Nights"}),e.jsx("input",{type:"number",id:"numberNights",name:"numberNights",className:"form-control",value:c.numberNights,onChange:f,disabled:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"roomAssigned",className:"form-label",children:"Assigned Rooms"}),l.map((t,o)=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("select",{value:t.roomType,onChange:s=>J(o,s.target.value),className:"form-control",children:[e.jsx("option",{value:"",children:"Select Room Type"}),B.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),t.roomType&&e.jsxs("select",{value:t.roomAssigned,onChange:s=>z(o,s.target.value),className:"form-control mt-2",children:[e.jsx("option",{value:"",children:"Select Room"}),Q(t.roomType).map(s=>e.jsx("option",{value:s.id,children:V(s.id)},s.id))]}),e.jsx("button",{type:"button",onClick:()=>L(o),className:"btn btn-danger mt-2",children:"Remove Room"})]},o)),e.jsx("button",{type:"button",onClick:K,className:"btn btn-primary",children:"Add Room"})]}),e.jsx("button",{type:"submit",className:"btn btn-success",children:n?"Update Reservation":"Add Reservation"})]})})]}),e.jsxs(r,{show:O,onHide:S,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Error"})}),e.jsx(r.Body,{children:H}),e.jsx(r.Footer,{children:e.jsx(D,{variant:"secondary",onClick:S,children:"Close"})})]}),e.jsxs(r,{show:$,onHide:w,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Success"})}),e.jsx(r.Body,{children:q}),e.jsx(r.Footer,{children:e.jsx(D,{variant:"secondary",onClick:w,children:"Close"})})]})]})};export{ee as R};
