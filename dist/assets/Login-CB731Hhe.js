import{r as l,o as _,j as e,k as D,A as N,B as g,D as G,E as R,F as B,G as J,H as b,I as w,f as E,L as M,J as O,q as P}from"./index-ffYVKfzY.js";import{C as L}from"./index.esm-DxGkv9hs.js";/* empty css               */import{C as S}from"./CInputGroupText-DnCB_nJN.js";import{c as q}from"./cil-user-Ddrdy7PS.js";import{c as A}from"./cil-lock-locked-DmxpJbVL.js";const W=()=>{const[t,I]=l.useState(""),[i,T]=l.useState(""),[j,o]=l.useState(""),f=_();l.useEffect(()=>{localStorage.setItem("theme","light"),document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme")},[]);const F=async a=>{if(a.preventDefault(),console.log("Formulario enviado con:",{email:t,password:i}),!t){o("El email es obligatorio");return}try{const s=await O.post("http://localhost:5000/api/auth/login",{email:t,password:i});if(console.log("Respuesta del backend:",s),s.data&&s.data.accessToken){const c=s.data.accessToken;localStorage.setItem("token",c),console.log("Token guardado en localStorage:",c);const C=P(c);console.log("Token decodificado:",C);const{user_id:d,staff_id:m,role_id:r,permissions:n,name:u,lastname:p,email:x,phone:h,gen:k,created_at:v,updated_at:y}=C;if(!d||!m||!r||!n||!u||!p||!x||!h){o("Datos incompletos en el token");return}if(console.log("Datos del usuario:",{user_id:d,staff_id:m,role_id:r,permissions:n,name:u,lastname:p,email:x,phone:h,gen:k,created_at:v,updated_at:y}),!n){o("No se encontraron permisos en el token");return}localStorage.setItem("user",JSON.stringify({user_id:d,staff_id:m,role_id:r,permissions:n,name:u,lastname:p,email:x,phone:h,gen:k,created_at:v,updated_at:y})),r===1?f("/dashboard"):r===2?f("/clients"):o("Rol desconocido. No se puede redirigir.")}else o("Email o contraseña inválidos");window.location.reload()}catch(s){console.error("Error en login:",s),o("Ocurrió un error, por favor intente nuevamente.")}};return e.jsx("div",{className:"login-background d-flex flex-row align-items-center",children:e.jsx(D,{children:e.jsx(N,{className:"justify-content-center",children:e.jsx(g,{md:4,children:e.jsx(G,{children:e.jsx(R,{className:"p-4",children:e.jsx(B,{children:e.jsxs(J,{onSubmit:F,children:[e.jsx("h1",{children:"Login"}),e.jsx("p",{className:"text-body-secondary",children:"Sign In to your account"}),j&&e.jsx("div",{className:"text-danger mb-3",children:j}),e.jsxs(b,{className:"mb-3",children:[e.jsx(S,{children:e.jsx(L,{icon:q})}),e.jsx(w,{type:"email",placeholder:"Email",autoComplete:"email",value:t,onChange:a=>I(a.target.value)})]}),e.jsxs(b,{className:"mb-4",children:[e.jsx(S,{children:e.jsx(L,{icon:A})}),e.jsx(w,{type:"password",placeholder:"Password",autoComplete:"current-password",value:i,onChange:a=>T(a.target.value)})]}),e.jsxs(N,{children:[e.jsx(g,{xs:6,children:e.jsx(E,{color:"primary",className:"px-4",type:"submit",children:"Login"})}),e.jsx(g,{xs:6,className:"text-right",children:e.jsx(M,{to:"/forgot-password",children:e.jsx(E,{color:"link",className:"px-0",children:"Forgot password?"})})})]})]})})})})})})})})};export{W as default};
